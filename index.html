<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بازی جنگل من</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const cellSize = 600; // هر خانه بزرگ‌تر برای تصاویر بهتر
        const mapWidth = cellSize * 3;
        const mapHeight = cellSize * 3;

        // تصاویر
        const playerImg = new Image();
        playerImg.src = 'https://img.craftpix.net/2024/07/Free-Base-4-Direction-Male-Character-Pixel-Art.webp'; // sprite sheet کاراکتر

        const treeImg = new Image();
        treeImg.src = 'https://opengameart.org/sites/default/files/free_peview_0.png'; // tileset با درخت‌ها (از نمونه درخت استفاده می‌کنه)

        const marketImg = new Image();
        marketImg.src = 'https://img.craftpix.net/2025/08/Pixel-Art-Market-Square-RPG-Shop-and-NPC-Assets-Pack4-720x480.webp'; // غرفه بازار

        // موقعیت کاراکتر
        let player = { x: mapWidth / 2, y: mapHeight / 2, width: 64, height: 64, speed: 4, direction: 'down' };
        let target = { x: player.x, y: player.y };
        let camera = { x: 0, y: 0 };

        // موجودی
        let wood = 0;
        let coins = 0;

        // درخت‌ها در جنگل بالا چپ
        const trees = [
            { x: 200, y: 200, collected: false },
            { x: 400, y: 150, collected: false },
            { x: 150, y: 400, collected: false },
            { x: 350, y: 350, collected: false }
        ];

        // کلیک برای حرکت
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            target.x = e.clientX - rect.left + camera.x;
            target.y = e.clientY - rect.top + camera.y;
        });

        function gameLoop() {
            // حرکت کاراکتر
            const dx = target.x - player.x;
            const dy = target.y - player.y;
            const dist = Math.hypot(dx, dy);
            if (dist > 5) {
                player.x += (dx / dist) * player.speed;
                player.y += (dy / dist) * player.speed;

                // جهت کاراکتر (ساده)
                if (Math.abs(dx) > Math.abs(dy)) {
                    player.direction = dx > 0 ? 'right' : 'left';
                } else {
                    player.direction = dy > 0 ? 'down' : 'up';
                }
            }

            // دوربین follow
            camera.x = player.x - canvas.width / 2;
            camera.y = player.y - canvas.height / 2;
            camera.x = Math.max(0, Math.min(camera.x, mapWidth - canvas.width));
            camera.y = Math.max(0, Math.min(camera.y, mapHeight - canvas.height));

            // پاک کردن
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // background جنگل
            ctx.fillStyle = '#228B22';
            ctx.fillRect(-camera.x, -camera.y, mapWidth, mapHeight);

            // مرز خانه‌ها
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 6;
            for (let i = 0; i <= 3; i++) {
                ctx.beginPath();
                ctx.moveTo(i * cellSize - camera.x, -camera.y);
                ctx.lineTo(i * cellSize - camera.x, mapHeight - camera.y);
                ctx.moveTo(-camera.x, i * cellSize - camera.y);
                ctx.lineTo(mapWidth - camera.x, i * cellSize - camera.y);
                ctx.stroke();
            }

            // رندر درخت‌ها (اگر لود شده)
            if (treeImg.complete) {
                trees.forEach(tree => {
                    if (!tree.collected) {
                        ctx.drawImage(treeImg, 0, 0, 200, 200, tree.x - camera.x - 50, tree.y - camera.y - 100, 100, 150); // برش ساده از tileset
                    }
                });
            }

            // رندر بازار
            if (marketImg.complete) {
                ctx.drawImage(marketImg, 200 - camera.x, mapHeight - 300 - camera.y, 200, 150);
            }

            // جمع‌آوری چوب
            trees.forEach(tree => {
                if (!tree.collected && Math.hypot(player.x - tree.x, player.y - tree.y) < 80) {
                    wood += 1;
                    tree.collected = true;
                }
            });

            // فروش در بازار
            if (player.x < cellSize && player.y > mapHeight - cellSize && wood > 0) {
                coins += wood * 2;
                wood = 0;
            }

            // رندر کاراکتر (اگر لود شده - برش ساده down)
            if (playerImg.complete) {
                ctx.drawImage(playerImg, 0, 0, 64, 64, player.x - camera.x - 32, player.y - camera.y - 48, 64, 64);
            } else {
                // fallback ساده
                ctx.fillStyle = '#00BFFF';
                ctx.fillRect(player.x - camera.x - 32, player.y - camera.y - 32, 64, 64);
            }

            // موجودی
            ctx.fillStyle = '#FFF';
            ctx.font = '30px Arial';
            ctx.fillText(`چوب: ${wood}   سکه: ${coins}`, 20, 50);

            requestAnimationFrame(gameLoop);
        }

        // شروع بعد از لود تصاویر
        Promise.all([new Promise(res => playerImg.onload = res), new Promise(res => treeImg.onload = res), new Promise(res => marketImg.onload = res)])
            .then(() => gameLoop());

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
